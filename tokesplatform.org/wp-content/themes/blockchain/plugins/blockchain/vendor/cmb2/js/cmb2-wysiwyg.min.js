window.CMB2=window.CMB2||{};window.CMB2.wysiwyg=window.CMB2.wysiwyg||{};(function(f,h,d,e,c){var b=[];var g=[];var i=e.all={};function k(){if(0===b.length){g.forEach(function(m){g.splice(g.indexOf(m),1);e.init.apply(e,m)})}else{f.setTimeout(k,100)}}function l(){b.forEach(function(m){b.splice(b.indexOf(m),1);e.destroy(m)})}function j(o){var n=o.groupid;var m=o.fieldid;if(!i[n]||!i[n][m]){i[n]=i[n]||{};i[n][m]={template:wp.template("cmb2-wysiwyg-"+n+"-"+m),defaults:{mce:d.extend({},tinyMCEPreInit.mceInit["cmb2_i_"+n+m]),qt:d.extend({},tinyMCEPreInit.qtInit["cmb2_i_"+n+m])}};delete tinyMCEPreInit.mceInit["cmb2_i_"+n+m];delete tinyMCEPreInit.qtInit["cmb2_i_"+n+m]}return i[n][m]}function a(p){var r=new RegExp("cmb2_n_"+p.groupid+p.fieldid,"g");var o=new RegExp("cmb2_i_"+p.groupid+p.fieldid,"g");var q,n,m;if("undefined"===typeof(tinyMCEPreInit.mceInit[p.id])){n=d.extend({},p.defaults.mce);for(q in n){if("string"===typeof(n[q])){n[q]=n[q].replace(o,p.id).replace(r,p.name)}}tinyMCEPreInit.mceInit[p.id]=n}if("undefined"===typeof(tinyMCEPreInit.qtInit[p.id])){m=d.extend({},p.defaults.qt);for(q in m){if("string"===typeof(m[q])){m[q]=m[q].replace(o,p.id).replace(r,p.name)}}tinyMCEPreInit.qtInit[p.id]=m}}e.initAll=function(){var o,n,m;d(".cmb2-wysiwyg-placeholder").each(function(){o=d(this);n=o.data();if(n.groupid){n.id=o.attr("id");n.name=o.attr("name");n.value=o.val();e.init(o,n,false);m=true}});if(true===m){if("undefined"!==typeof f.QTags){f.QTags._buttonsInit()}d(h).on("cmb2_add_row",e.addRow).on("cmb2_remove_group_row_start",e.destroyRowEditors).on("cmb2_shift_rows_start",e.shiftStart).on("cmb2_shift_rows_complete",e.shiftComplete)}};e.addRow=function(n,m){e.initRow(m)};e.destroyRowEditors=function(m,n){e.destroy(n.parents(".cmb-repeatable-grouping").find(".wp-editor-area").attr("id"))};e.shiftStart=function(m,o,n,p){n.add(p).find(".wp-editor-wrap textarea").each(function(){e.destroy(d(this).attr("id"))})};e.shiftComplete=function(m,o,n,p){n.add(p).each(function(){e.initRow(d(this))})};e.initRow=function(m){var o,n;m.find(".cmb2-wysiwyg-inner-wrap").each(function(){o=d(this);n=o.data();n.iterator=m.data("iterator");n.fieldid=n.id;n.id=n.groupid+"_"+n.iterator+"_"+n.fieldid;n.name=n.groupid+"["+n.iterator+"]["+n.fieldid+"]";n.value=o.find(".wp-editor-area").length?o.find(".wp-editor-area").val():"";if(0===b.length){e.init(o,n)}else{g.push([o,n]);f.setTimeout(k,100)}})};e.init=function(o,n,m){if(!n.groupid){return false}d.extend(n,j(n));a(n);o.replaceWith(n.template(n));f.tinyMCE.init(tinyMCEPreInit.mceInit[n.id]);if("function"===typeof f.quicktags){f.quicktags(tinyMCEPreInit.qtInit[n.id])}d(h.getElementById(n.id)).parents(".wp-editor-wrap").removeClass("html-active").addClass("tmce-active");if(false!==m&&"undefined"!==typeof f.QTags){f.QTags._buttonsInit()}};e.destroy=function(n){var m=tinyMCE.get(n);if(m!==null&&typeof(m)!=="undefined"){m.destroy();if("undefined"===typeof(tinyMCEPreInit.mceInit[n])){delete tinyMCEPreInit.mceInit[n]}if("undefined"===typeof(tinyMCEPreInit.qtInit[n])){delete tinyMCEPreInit.qtInit[n]}}else{if(-1===b.indexOf(n)){b.push(n);f.setTimeout(l,100)}}};d(h).on("cmb_init",e.initAll)})(window,document,jQuery,window.CMB2.wysiwyg);